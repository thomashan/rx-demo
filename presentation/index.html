<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Basic (and advanced) Intro to RX (Reactive)</title>

    <meta name="description" content="Introduction to RX">
    <meta name="author" content="Thomas Han">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <h1>Reactive Microservices</h1>
            <p>Thomas Han - Lead Software Engineer @ Odecee</p>
        </section>

        <section>
            <h2>Agenda</h2>
            <ul>
                <li>Intro to reactive programming</li>
                <ul>
                    <li>What is reactive programming?</li>
                    <li>Why reactive?</li>
                </ul>
                <li>Being Reactive</li>
                <ul>
                    <li>Add more resilience</li>
                    <li>Replace ESB with dumb message pipes</li>
                    <li>Break request/response idiom</li>
                    <li>Throttling - Managing backpressure</li>
                </ul>
                <li>Demo</li>
            </ul>
        </section>

        <section>
            <h2>Intro to reactive programming</h2>
            <ul>
                <li>What is reactive programming?</li>
                <li>Why reactive?</li>
            </ul>
        </section>

        <section>
            <section>
                <h2>What is reactive programming?</h2>
            </section>
            <section>
                <h2>Google it! (not)...</h2>
                <p>There's lots of bad explanations and definitions out there! Don't start with those.</p>
                <p>The best way to learn RX is hands-on doing and reading.</p>
                <p>It's really hard to switch your mind to view everything as streams.</p>
                <h3>Remember everything is a stream! Everything!</h3>
            </section>
            <section>
                <h2>Good starting points</h2>
                <p>Some of the good hands-on tutorials to start with are</p>
                <ul>
                    <li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank">André Staltz - The
                        introduction to Reactive Programming you've been missing</a></li>
                    <li><a href="https://egghead.io/series/introduction-to-reactive-programming" target="_blank">André
                        Staltz (video) - Introduction to Reactive Programming</a></li>
                </ul>
                <p>Bible of RX</p>
                <ul>
                    <li><a href="http://www.introtorx.com/" target="_blank">Lee Campbell - Introduction to RX (heavy
                        reading, reference book, Microsoft oriented where it (RX) all began)</a></li>
                </ul>
            </section>
            <section>
                <h2>So what is reactive programming again?</h2>
                <p>It's programming with streams of data.</p>
                <p>What is data?</p>
            </section>
            <section>
                <h2>What is data?</h2>
                <p>Data can be anything you choose it to be.</p>
                <ul>
                    <li>click events</li>
                    <li>data structures</li>
                    <li>variables</li>
                    <li>user input</li>
                    <li>caches</li>
                    <li>twitter feeds</li>
                    <li>HTTPS requests</li>
                    <li>service requests</li>
                </ul>
            </section>
        </section>
        </section>

        <section>
            <section>
                <h2>Why reactive?</h2>
            </section>
            <section>
                <h2><a href="http://www.reactivemanifesto.org/" target="_blank">Reactive Manifesto</a></h2>
                <ul>
                    <li>Responsive</li>
                    <li>Resilient</li>
                    <li>Elastic</li>
                    <li>Message Driven</li>
                </ul>
                <img data-src="images/reactive-traits.svg">
            </section>
            <section>
                <h2>Why reactive?</h2>
                <p>It turns out many companies working on different domains were independently discovering patterns for
                    building software that looked the same. Reactive!</p>
                <p>Reactive programming provides a higher abstraction than imperative or declarative programming,
                    ultimately increasing productivity in domains where RX excelled at (in some cases by order of
                    magnitudes).</p>
                <p>Analogy: productivity gained by employing java over assembly as a general programming language.</p>
            </section>
            <section>
                <h2>Why reactive?</h2>
                <p>The reactive extensions (RX) originally developed by Microsoft.</p>
                <p>Application using RX showed the properties outlined in reactive manifesto.</p>
                <p><a href="http://reactivex.io/" target="_blank">RX has been ported to many different languages</a></p>
            </section>
            <section>
                <h2>RX Everywhere</h2>
                <ul>
                    <li>C#: <a href="https://github.com/Reactive-Extensions/Rx.NET" target="_blank">Rx.NET</a></li>
                    <li>C#(Unity): <a href="https://github.com/neuecc/UniRx" target="_blank">UniRx</a></li>
                    <li>Java: <a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava</a></li>
                    <li>JavaScript: <a href="https://github.com/Reactive-Extensions/RxJS" target="_blank">RxJS</a></li>
                    <li>Scala: <a href="https://github.com/ReactiveX/RxScala" target="_blank">RxScala</a></li>
                    <li>Groovy: <a href="https://github.com/ReactiveX/RxGroovy" target="_blank">RxGroovy</a></li>
                    <li>Clojure: <a href="https://github.com/ReactiveX/RxClojure" target="_blank">RxClojure</a></li>
                    <li>C++: <a href="https://github.com/Reactive-Extensions/RxCpp" target="_blank">RxCpp</a></li>
                    <li>Ruby: <a href="https://github.com/Reactive-Extensions/Rx.rb" target="_blank">Rx.rb</a></li>
                    <li>Python: <a href="https://github.com/ReactiveX/RxPY" target="_blank">RxPY</a></li>
                    <li>JRuby: <a href="https://github.com/ReactiveX/RxJRuby" target="_blank">RxJRuby</a></li>
                    <li>Kotlin: <a href="https://github.com/ReactiveX/RxKotlin" target="_blank">RxKotlin</a></li>
                    <li>Swift: <a href="https://github.com/kzaher/RxSwift" target="_blank">RxSwift</a></li>
                </ul>
            </section>
            <section>
                <h2>What is reactive, reactive programming, RX recapped</h2>
                <p>Reactive: mindset that follows the reactive manifesto</p>
                <p>Reactive Programming: programming paradigm that works with streams of data</p>
                <p>RX: library that works with observables (streams of data)</p>
                <p>Other libraries which implements reactive programming are Akka actor and Akka stream not part of the
                    RX family.</p>
            </section>
        </section>
        <section>
            <section>
                <h2>Building Reactive Microservices</h2>
                <p><a href="http://www.infoq.com/presentations/reactive-arch-grails" target="_blank">Excellent, highly
                    recommended presentation by Steve Pember - Reactive Oriented Architecture with Grails</a></p>
                <p><a href="http://www.slideshare.net/StevePember/reactive-microservice-architecture" target="_blank">and
                    the complimentary slideshare - Reactive Microservice Architecture with Groovy and Grails </a></p>
            </section>
            <section>
                <h2>Building Reactive Microservices</h2>
                <p>Reactive manifesto v1.1 states:</p>
                <blockquote class="fragment"
                            cite="http://www.reactivemanifesto.org/pdf/the-reactive-manifesto.pdf">&ldquo;An application
                    must be reactive from top to bottom.&rdquo;</blockquote>
            </section>
        </section>
        <section>
            <section>
                <h2>Service engines</h2>
                <p class="fragment">Service Engine &ne; Reactive Microservice</p>
                <span class="fragment">
                    <p>Service Engine &cong; Microservice</p>
                </span>
                <p class="fragment">Service engines use some reactive components (e.g. hystrix) but remember a reactive
                    application has to be reactive from top to bottom.</p>
                <p class="fragment">The most important thing in building truly reactive microservices is the mindset and
                    architecture and not the framework</p>
            </section>
            <section>
                <h2>Making Service Engines More Reactive</h2>
                <ol>
                    <li>Add more resilience</li>
                    <li>Replace ESB with dumb pipe</li>
                    <li>Break request/response mindset and use messaging</li>
                    <li>Managing backpressure - throttling</li>
                </ol>
            </section>
        </section>
        <section>
            <section>
                <h2>Add more resilience</h2>
            </section>
            <section data-background="images/resilence-all.png" data-background-size="60%">
            </section>
            <section>
                <h2>1% chance of any node going down independently</h2>
            </section>
            <section data-background="images/resilence-outage.png" data-background-size="60%">
                <h2>1%</h2>
            </section>
            <section>
                <p>The probability of six end-points going down is 1% = (0.01)</p>
                <p class="fragment">Now, lets divide the end-points so they fail independently</p>
            </section>
            <section data-background="images/resilence-outage-independent.png" data-background-size="60%">
                <h2>0.0001%</h2>
            </section>
            <section>
                <p>The probability of six endpoints going down is 0.0001% = (0.01 * 0.01 * 0.01)</p>
            </section>
            <section>
                <p>We've put resiliency by setting up the services so they fail independently.</p>
            </section>
            <section>
                <p>I hear you say: "But that's way harder to maintain"</p>
                <p class="fragment">High availability vs maintenance</p>
                <p class="fragment">Another perspective, which is worse?</p>
                <span class="fragment">
                    <p>Customers not being able to perform actions like making payments, transferring money overseas,
                        listing accounts, etc</p>
                    <p>vs</p>
                    <p>Making it harder for devops to maintain</p>
                </span>
            </section>
        </section>
        <section>
            <section><h2>Replace ESB with dumb pipes</h2></section>
            <section>
                <h2>Why?</h2>
                <p class="fragment">Because ESB</p>
                <ul>
                    <li class="fragment">Contains complex routing - increases latency moderately</li>
                    <li class="fragment">Contains business logic - increases latency considerably</li>
                </ul>
                <p class="fragment">Low latency is king in the reactive land</p>
            </section>
            <section>
                <h2>What should we be doing?</h2>
                <p>Distribute the smarts to the microservices</p>
                <p>The microservice should know how to:</p>
                <ul>
                    <li class="fragment">pick up the message (event/stream)</li>
                    <li class="fragment">process the message (event/stream)</li>
                    <li class="fragment">respond to the message (event/stream)</li>
                </ul>
            </section>
        </section>
        <section>
            <section><h2>Break request/response mindset and use messaging</h2></section>
            <section>
                <h2>Not everything has to be request/response</h2>
                <p class="fragment">Currently all inter-service communication is done through HTTP(S)</p>
                <ul>
                    <li class="fragment">Making HTTP requests (especially HTTPS) is order of magnitudes more expensive
                        than pushing messages to a dumb message bus.
                        <a href="https://engineering.linkedin.com/kafka/benchmarking-apache-kafka-2-million-writes-second-three-cheap-machines"
                           target="_blank">(Kafka can write 2 million message per second with three nodes)</a></li>
                    <li class="fragment">The microservice making the request is tightly coupled to the responding
                        microservice. It expects the response to come back in the same HTTP connection.
                    </li>
                </ul>
            </section>
            <section>
                <h2>HTTP(S) connection negotiation is expensive</h2>
                <p>Assuming a typical latencies of 28ms, time to establish a connection</p>
                <ul>
                    <li>HTTP: 56ms (1 round trip)</li>
                    <li>HTTPS: 168ms (3 round trips)</li>
                </ul>
                <p></p>
                <a href="http://serverfault.com/questions/570387/https-overhead-compared-to-http" target="_blank">Image on the next slide.</a>
            </section>
            <section data-background="images/Rcq1a.png" data-background-size="60%">
            </section>
            <section>
                <p>A word from an expert</p>
                <span class="fragment">
                <blockquote>It is unfortunate that REST is widely considered as the default
                    Microservice communication protocol. It’s important to understand that REST is most often
                    synchronous which makes it a very unfitting default protocol for inter-service communication.
                    <br/>-Reactive Microservices Architecture: Design Principles for Distributed Systems, Jonas Boner-
                </blockquote>
                <p>Reactive Microservices Architecture: Design Principles for Distributed Systems, highly recommended <a
                        href="https://www.lightbend.com/blog/reactive-microservices-architecture-free-oreilly-report-by-lightbend-cto-jonas-boner"
                        target="_blank"> reading</a></p>
                </span>
            </section>
            <section>
                <h2>Not everything has to be request/response</h2>
                <ul>
                    <li class="fragment">It doesn't matter who created the responses as long as the client can pick up
                        the response somehow.
                    </li>
                    <li class="fragment">Some operations don't require responses to be returned in timely manner.</li>
                    <li class="fragment">Makes testing hard if the responding microservice is not available.</li>
                </ul>
            </section>
            <section>
                <h2>What are the alternatives to request/response interaction style?</h2>
                <p>nginx has a very comprehensive <a
                        href="https://www.nginx.com/blog/building-microservices-inter-process-communication/">blog</a>
                    outlining the interaction styles.</p>
                <p>Although using REST for request/response is good for exposing APIs to clients, it's not the best
                    style for inter-service communication.</p>
                <p>In fact they only use request/response once at the initialisaton phase and everything else is
                    publish/subscribe or notification style interactions.</p>
            </section>
            <section data-background="images/Richardson-microservices-part3-taxi-service.png"
                     data-background-size="70%">
            </section>
        </section>
        <section>
            <section>
                <h2>Throttling - Managing backpressure</h2>
                <p>RX has built-in <a href="http://reactivex.io/documentation/operators/backpressure.html"
                                      target="_blank">throttling controls</a> or backpressure in reactive terminology.
                </p>
            </section>
            <section data-background="images/throttle.png" data-background-size="60%">
                <p>Each microservice has config for throttling.</p>
            </section>
            <section data-background="images/throttle.png" data-background-size="60%">
                <p>This is not going to work if you want dynamic scaling.</p>
            </section>
            <section data-background="images/throttle_blowup.png" data-background-size="50%">
                <p><strong>Kaboom!!</strong></p>
            </section>
            <section>
                <p>We need a better way to handle backpressure.</p>
                <p>A centralised microservice to handle backpressure to each back-end system.</p>
            </section>
            <section data-background="images/throttle_reactive.png" data-background-size="80%">
                <p style="margin-bottom: 800px;">A single microservice should manage backpressure to each back-end
                    system</p>
            </section>
            <section>
                <h2>Backpressure</h2>
                <p><a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/backpressure.md"
                      target="_blank">There are two ways of handling backpressure</a></p>
                <ul>
                    <li>loseless - where messages are not dropped (increases memory consumption)</li>
                    <li>lossy - where messages are dropped</li>
                </ul>
            </section>
            <section>
                <p>Lossless backpressure operators</p>
                <ul>
                    <li>observable.buffer() - by time or count</li>
                    <li>observable.window() - by time or count</li>
                    <li>observable.pausableBuffered() - buffers messages between pause and resume</li>
                    <li>observable.controlled() - process number of messages for a time interval</li>
                </ul>
                <p>Lossy backpressure operators</p>
                <ul>
                    <li>observable.debounce() - process next message only after certain time</li>
                    <li>observable.throttle() - drop everything after throttle has been reached</li>
                    <li>observable.sample() - process next message at intervals</li>
                    <li>observable.pausable() - drops message between pause and resume</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <h2>So are the other companies doing this right?</h2>
            </section>
            <section>
                <h2>Very few companies are doing (reactive microservices) it right at large scale.</h2>
                <p class="fragment">Can you guess which ones?</p>
                <p class="fragment">Netflix</p>
            </section>
        </section>
        <section>
            <section><h2>Demo</h2></section>
            <section data-background-color="white">
                <span style="margin: 20px;"><img src="images/grails-logo-sm.png"></span>
                <span style="margin: 20px;"><img src="images/Gatling_(load_testing_tool)_Logo.png"></span>
                <span style="margin: 20px;"><img src="images/springboot.png"></span>
                <span style="margin: 20px;"><img src="images/images.png"></span>
                <span style="margin: 20px;"><img src="images/200px-Groovy-logo.svg.png"></span>
                <span style="margin: 20px;"><img src="images/scala-logo1.png"></span>
                <span style="margin: 20px;"><img src="images/Reactive-Extensions.png"></span>
            </section>
            <section data-background="images/demo-traditional.png" data-background-size="25%">
                <h2>Architecture - Traditional</h2>
            </section>
            <section data-background="images/demo-reactive.png" data-background-size="25%">
                <h2>Architecture - Reactive</h2>
                <p>
                    <br/><br/><br/><br/><br/><br/><br/><br/><br/>
                </p>
            </section>
            <section>
                <h2>Run services</h2>
                <pre>
                     <code>
                         > ./run.sh
                     </code>
                </pre>
            </section>
            <section>
                <h2>Service2 - Dead</h2>
                <p>Traditional - All requests to service1 will fail and be lost</p>
                <p>Reactive - All requests will be queued up in the message bus. Service2 will pick up the message and
                    process the messages once it's up.</p>
                <p>Service2 doesn't need to be running at the same time as service1 to process the message
                    successfully.</p>
            </section>
            <section>
                <h2>Traditional - 2500 requests</h2>
                <pre>
                    <code>
                        performance> ./hit_it.sh
                    </code>
                </pre>
            </section>
            <section>
                <h2>Reactive - 2500 message</h2>
                <pre>
                    <code>
                        service1> ./hit_it.sh
                        service2> ./run.sh
                    </code>
                </pre>
            </section>
            <section>
                <h2>Performance - processing 2500 requests</h2>
                <p>All services up and running</p>
                <ul>
                    <li>Traditional (60s and some may fail)<br/>
                        <code>
                            performance> ./hit_it.sh
                        </code>
                    </li>
                    <li>Reactive (&sime;3s and none failed)<br/>
                        <code>
                            service1> ./hit_it.sh
                        </code>
                    </li>
                </ul>

            </section>

        </section>

        <section>
            <h2>Agenda: Recap</h2>
            <ul>
                <li>Intro to reactive programming</li>
                <ul>
                    <li>What is reactive programming?</li>
                    <li>Why reactive?</li>
                </ul>
                <li>Being Reactive</li>
                <ul>
                    <li>Add more resilience</li>
                    <li>Replace ESB with dumb message pipes</li>
                    <li>Break request/response idiom</li>
                    <li>Throttling - Managing backpressure</li>
                </ul>
                <li>Demo</li>
            </ul>
        </section>

        <section>
            <section data-background="images/Old-House_4-11_600.jpg">
                <h2>Monolith</h2>
            </section>
            <section data-background="images/luxury-house-eternohome-luxury-house-photos-luxury-house-photos.jpg">
                <h2>Microservice</h2>
            </section>
            <section data-background="images/new_house_old_oven.jpg">
                <h2>Microservice</h2>
            </section>
            <section data-background="images/luxury-modern-kitchen.jpg">
                <h2>Reactive Microservice</h2>
            </section>
        </section>

        <section>
            <h2>Thank you!</h2>
        </section>
        <section>
            <h2>Questions?</h2>
        </section>

    </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });

</script>

</body>
</html>
